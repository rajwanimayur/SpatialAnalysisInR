\documentclass[]{article}
\usepackage{lmodern}
\usepackage{amssymb,amsmath}
\usepackage{ifxetex,ifluatex}
\usepackage{fixltx2e} % provides \textsubscript
\ifnum 0\ifxetex 1\fi\ifluatex 1\fi=0 % if pdftex
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
\else % if luatex or xelatex
  \ifxetex
    \usepackage{mathspec}
  \else
    \usepackage{fontspec}
  \fi
  \defaultfontfeatures{Ligatures=TeX,Scale=MatchLowercase}
\fi
% use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
% use microtype if available
\IfFileExists{microtype.sty}{%
\usepackage{microtype}
\UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\usepackage[margin=1in]{geometry}
\usepackage{hyperref}
\hypersetup{unicode=true,
            pdftitle={R and Spatial Data},
            pdfauthor={Prof.~Uttam Kumar, Mayur Rajwani},
            pdfborder={0 0 0},
            breaklinks=true}
\urlstyle{same}  % don't use monospace font for urls
\usepackage{color}
\usepackage{fancyvrb}
\newcommand{\VerbBar}{|}
\newcommand{\VERB}{\Verb[commandchars=\\\{\}]}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
% Add ',fontsize=\small' for more characters per line
\newenvironment{Shaded}{}{}
\newcommand{\AlertTok}[1]{\textcolor[rgb]{1.00,0.00,0.00}{\textbf{#1}}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{#1}}}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.49,0.56,0.16}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{#1}}
\newcommand{\BuiltInTok}[1]{#1}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{#1}}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textit{#1}}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{#1}}}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.53,0.00,0.00}{#1}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.00,0.44,0.13}{\textbf{#1}}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.56,0.13,0.00}{#1}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{#1}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.73,0.13,0.13}{\textit{#1}}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{1.00,0.00,0.00}{\textbf{#1}}}
\newcommand{\ExtensionTok}[1]{#1}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.02,0.16,0.49}{#1}}
\newcommand{\ImportTok}[1]{#1}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{#1}}}}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.00,0.44,0.13}{\textbf{#1}}}
\newcommand{\NormalTok}[1]{#1}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.40,0.40,0.40}{#1}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.00,0.44,0.13}{#1}}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.74,0.48,0.00}{#1}}
\newcommand{\RegionMarkerTok}[1]{#1}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{#1}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.73,0.40,0.53}{#1}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{#1}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0.10,0.09,0.49}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{#1}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{#1}}}}
\usepackage{graphicx,grffile}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
\IfFileExists{parskip.sty}{%
\usepackage{parskip}
}{% else
\setlength{\parindent}{0pt}
\setlength{\parskip}{6pt plus 2pt minus 1pt}
}
\setlength{\emergencystretch}{3em}  % prevent overfull lines
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
\setcounter{secnumdepth}{0}
% Redefines (sub)paragraphs to behave more like sections
\ifx\paragraph\undefined\else
\let\oldparagraph\paragraph
\renewcommand{\paragraph}[1]{\oldparagraph{#1}\mbox{}}
\fi
\ifx\subparagraph\undefined\else
\let\oldsubparagraph\subparagraph
\renewcommand{\subparagraph}[1]{\oldsubparagraph{#1}\mbox{}}
\fi

%%% Use protect on footnotes to avoid problems with footnotes in titles
\let\rmarkdownfootnote\footnote%
\def\footnote{\protect\rmarkdownfootnote}

%%% Change title format to be more compact
\usepackage{titling}

% Create subtitle command for use in maketitle
\providecommand{\subtitle}[1]{
  \posttitle{
    \begin{center}\large#1\end{center}
    }
}

\setlength{\droptitle}{-2em}

  \title{R and Spatial Data}
    \pretitle{\vspace{\droptitle}\centering\huge}
  \posttitle{\par}
    \author{Prof.~Uttam Kumar, Mayur Rajwani}
    \preauthor{\centering\large\emph}
  \postauthor{\par}
      \predate{\centering\large\emph}
  \postdate{\par}
    \date{2020-01-17. See
\href{https://github.com/rajwanimayur/SpatialAnalysis}{github.com/rajwanimayur/SpatialAnalysis.pdf}
for latest version}


\begin{document}
\maketitle

{
\setcounter{tocdepth}{2}
\tableofcontents
}
\hypertarget{preface}{%
\section{Preface}\label{preface}}

The objective of this tutorial is to provide its readers the necessary
skills to visualise diverse range of geographical and non-geographical
datasets and make meaningful inferences.

The tutorial is practical in nature, where you will load-in, visualise
and manipulate spatial data. The tutorial requires basic knowledge of R,
thus if you do not have prior experience of using R, it is advised to
follow the tutorial -
\href{https://cran.r-project.org/doc/contrib/Paradis-rdebuts_en.pdf}{\emph{R
for beginners by Emmanuel Paradis}}.

\hypertarget{why-r}{%
\subsection{Why R?}\label{why-r}}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  R is free and open-source.
\item
  Using R, researchers can reproduce their work and verify other
  people's work.
\item
  R has numerous packages available for spatial data analysis,
  statistical modelling, econometrics, visualising and more.
\end{enumerate}

Now you know the usage and benefits of using R for spatial data
analysis, its now time to delve deeper into it. To that end, this
tutorial is organised as follows:

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  \textbf{Introduction} : provides a guide to R's syntax and preparing
  you for the tutorial.
\item
  \textbf{Handling Spatial Data in R}: describing basic spatial
  functions in R
\item
  \textbf{Data Preparation} : which include creating and manipulating
  spatial data for visualisations.
\item
  \textbf{Data Visualisation - Making Interactive Maps in R} : this
  section will demonstrate map making with R's advanced visualisation
  tools, namely \textbf{ggmap}.
\item
  \textbf{Analysing Spatial Data} : In this section, we analyse the road
  accidents data for all states in India, over all the period of four
  years altogether.
\end{enumerate}

To distinguish between prose and code, please be aware of the following
typographic conventions used in this document: R code
(e.g.~\texttt{plot(x,\ y)}) is written in a \texttt{monospace} font and
package names (e.g.~\textbf{rgdal}) are written in \textbf{bold}. A
double hash (\texttt{\#\#}) at the start of a line of code indicates
that this is output from R. Lengthy outputs have been omitted from the
document to save space, so do not be alarmed if R produces additional
messages: you can always look up them up on-line.

\begin{quote}
As an advice, we encourage you to play with the code. Try out new
things, explore different ways to do similar tasks and enjoy the
learning ride.
\end{quote}

This tutorial makes use of RStudio, an IDE(Integrated Development
Environment) with code editor and tools for debugging and visualization.
RStudio makes it easier to use R. To download Rstudio, visit -
\url{https://www.rstudio.com}

\clearpage

\hypertarget{introduction}{%
\section{1. Introduction}\label{introduction}}

R has a huge and growing number of spatial data packages. We recommend
taking a quick browse on R's main website to see the spatial packages
available at: \url{http://cran.r-project.org/web/views/Spatial.html}. We
highlight few packages below, which are used extensively in this
tutorial. One is advised to download all recommended packages
beforehand.

\begin{itemize}
\tightlist
\item
  \textbf{sp} : This package provides classes and methods for spatial
  data; utility functions for plotting maps, working with coordinates,
  etc.
\item
  \textbf{ggplot2} : The most popular package for data visualization.
\item
  \textbf{ggmap} : extends the plotting package ggplot2 for maps. ggmap
  provides functions to visualise spatial data on top of static maps
  from sources like Google Maps, Open Street Maps, cloudmade and stamen.
\item
  \textbf{rgdal} : This package provides methods for working with
  importing and exporting different raster and vector geospatial data
  formats; Coordinate Reference Systems; projections, etc.
\item
  \textbf{rgeos} : R's interface to the powerful vector processing
  library geos. It provides functions for handling operations on
  topologies.
\item
  \textbf{dplyr} and \textbf{tidyr} : fast and concise data manipulation
  packages
\item
  \textbf{broom} : Takes messy output of built-in functions in R, and
  turns them into tidy data frames.
\item
  \textbf{tmap} : Package for rapidly creating beautiful maps.
\item
  \textbf{adehabitatHR} : Package providing functions for home-range
  analysis
\item
  \textbf{raster} : Package for reading/writing, analyzing and modelling
  of gridded spatial data.
\end{itemize}

Some packages may already be installed on your computer. To test if a
package is installed, try to load it using the \texttt{library}
function; for example, to test if \textbf{ggplot2} is installed, type
\texttt{library(ggplot2)} into the console window. If there is no output
from R, this is good news: it means that the library has already been
installed on your computer.

If you get an error message,you will need to install the package using
\texttt{install.packages("ggplot2")}. The package will download from the
Comprehensive R Archive Network (CRAN); if you are prompted to select a
`mirror', select one that is close to current location. If you have not
done so already, install these packages on your computer now. A
\href{http://stackoverflow.com/questions/8175912/load-multiple-packages-at-once}{quick
way} to do this in one go is to enter the following lines of code:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"sp"}\NormalTok{, }\StringTok{"ggplot2"}\NormalTok{, }\StringTok{"ggmap"}\NormalTok{, }\StringTok{"rgdal"}\NormalTok{, }\StringTok{"rgeos"}\NormalTok{, }\StringTok{"dplyr"}\NormalTok{, }\StringTok{"tidyr"}\NormalTok{, }\StringTok{"broom"}\NormalTok{, }\StringTok{"ggsn"}\NormalTok{, }\StringTok{"adehabitatHR"}\NormalTok{, }\StringTok{"tmap"}\NormalTok{, }\StringTok{"raster"}\NormalTok{) }
\CommentTok{# install.packages(x) # warning: uncommenting this may take a number of minutes}
\KeywordTok{lapply}\NormalTok{(x, library, }\DataTypeTok{character.only =} \OtherTok{TRUE}\NormalTok{) }\CommentTok{# load the required packages}
\end{Highlighting}
\end{Shaded}

\hypertarget{handling-spatial-data-in-r}{%
\section{2. Handling Spatial Data in
R}\label{handling-spatial-data-in-r}}

In this section, we will look at mapping and geographical data handling
capabilities of R. The aim of this section is to develop basic building
blocks for the Spatial data analysis in later sections.

All code and data used for this tutorial can be downloaded from
\href{https://github.com/rajwanimayur/SpatialAnalysisInR}{github
repository}. Click on the ``Download ZIP'' button on the right hand side
of the screen and once downloaded, unzip this to a new folder on your
computer.

Open the existing ``GISTutorial'' project using File -\textgreater{}
Open File\ldots{} on the top menu. Alternatively, you can also use the
project menu to open the project or create a new one. It is recommended
to use RStudio's projects to organise R work and organise files into
sub-folders and avoid digital clutter.

The ﬁrst ﬁle we are going to load into R Studio is the ``states''
shapeﬁle located in the \texttt{Data/States} folder of the project. It
is worth looking at this input dataset in your ﬁle browser before
opening it in R. You will notice that there are several ﬁles named
``states'', all with different ﬁle extensions. This is because a
shapeﬁle is actually made up of a number of different ﬁles, such as
.prj, .dbf and .shp. You could also try opening the ﬁle ``states.shp''
ﬁle in a conventional GIS such as QGIS to see what a shapeﬁle contains.
You should also open ``states.dbf'' in a spreadsheet program such as
Microsoft Excel, or LibreOffice Calc. to see what this ﬁle contains.
Once you think you understand the input data, it's time to open it in R.
There are a number of ways to do this, the most commonly used and
versatile of which is \textbf{readOGR}. This function, from the
\textbf{rgdal} package, automatically extracts the information regarding
the data.

\textbf{rgdal} is R's interface to the ``Geospatial Abstraction Library
(GDAL)'' which is used by other open source GIS packages such as QGIS
and enables R to handle a broader range of spatial data formats.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(rgdal)}
\NormalTok{states_raw <-}\StringTok{ }\KeywordTok{readOGR}\NormalTok{(}\DataTypeTok{dsn =} \StringTok{"Data/States/states.shp"}\NormalTok{, }\DataTypeTok{stringsAsFactors =} \OtherTok{FALSE}\NormalTok{)}
\NormalTok{states <-}\StringTok{ }\NormalTok{states_raw}
\end{Highlighting}
\end{Shaded}

In the second line of code above the \textbf{readOGR} function is used
to load a shapefile and assign it to a new spatial object called
\emph{states}.

\textbf{readOGR} is a \emph{function} of the `\textbf{rgdal} package,
the first \emph{argument} of which \textbf{dsn:} ``data source name'',
the file or directory of the geographic data to be loaded. Recent
developments of \textbf{rgdal} package doesn't require specification of
layer file any longer. \emph{states} is now an spatial data object with
boundary data specifying the state name.

\hypertarget{the-structure-of-spatial-data-in-r}{%
\subsection{The Structure of spatial data in
R}\label{the-structure-of-spatial-data-in-r}}

Spatial objects like the \textbf{states} object are made up of a number
of different \emph{slots}. \emph{slots} provides the object oriented
representation of data in R. Each slot in an object (here \emph{states})
is a component of the object; like components (that is, elements) of a
list, this may be extracted and set, using the function `slot()' or more
often the operator `\,``@''\,'. However, they differ from list
components in important ways. First, slots can only be referred to, by
name and not by position, and there is no partial matching of names as
with list elements.

Lets have a look at slots in \textbf{states} object.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{slotNames}\NormalTok{(states)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "data"        "polygons"    "plotOrder"   "bbox"        "proj4string"
\end{verbatim}

In the above slots, the \textbf{data} slot and \textbf{polygons} are of
interest to us. The \emph{data} slot contains non geographic attribute
data (in this case the state name), while \emph{polygons} slot (or
\emph{lines} slot for line data) contains geographic information of
latitude and longitude. Thus the data slot is considered as the
attribute table and the geometry slot is the polygons that make up the
physical boundaries.

\hypertarget{basic-plotting}{%
\subsection{Basic Plotting}\label{basic-plotting}}

Now we have seen structure of our spatial object states, we will now
look at plotting them.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{plot}\NormalTok{(states) }\CommentTok{# Not shown, will plot the shapefile}
\end{Highlighting}
\end{Shaded}

\emph{plot} is one of the most useful functions in R. It can be used to
draw maps for spatial data objects as well as conventional graphs. This
is often referred as polymorphism.

R also provide powerful subsetting capabilities that can be accessed
very concisely using square brackets.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{#We first see the classes of all variables in spatial dataset}
\KeywordTok{sapply}\NormalTok{(states}\OperatorTok{@}\NormalTok{data, class)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##       ST_NM 
## "character"
\end{verbatim}

As evident, \texttt{ST\_NM} is of type character, Thus we do not need
any form of type conversion. Next we select states whose name starts
with ``A'' only.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{states}\OperatorTok{@}\NormalTok{data[}\KeywordTok{startsWith}\NormalTok{(states}\OperatorTok{$}\NormalTok{ST_NM, }\StringTok{"A"}\NormalTok{),]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "Andaman & Nicobar Island" "Arunanchal Pradesh"      
## [3] "Assam"                    "Andhra Pradesh"
\end{verbatim}

Next we will plot these selected states.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{sel <-}\StringTok{ }\KeywordTok{startsWith}\NormalTok{(states}\OperatorTok{$}\NormalTok{ST_NM, }\StringTok{"A"}\NormalTok{)}
\KeywordTok{plot}\NormalTok{(states[sel,])  }\CommentTok{# See Figure 1}
\end{Highlighting}
\end{Shaded}

\begin{figure}
\centering
\includegraphics{TutorialNotebook_files/figure-latex/unnamed-chunk-8-1.pdf}
\caption{States whose names starts with A}
\end{figure}

The plot is quite useful, but it only display the areas we selected. In
order to see the areas that meets the selection criteria, in context
with the other areas of the map we simply use the \emph{add = TRUE}
argument after the initial plot.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{#Plotting initial graph}
\KeywordTok{plot}\NormalTok{(states, }\DataTypeTok{col =} \StringTok{"lightgray"}\NormalTok{)}
\NormalTok{sel <-}\StringTok{ }\KeywordTok{startsWith}\NormalTok{(states}\OperatorTok{$}\NormalTok{ST_NM, }\StringTok{"A"}\NormalTok{)}
\KeywordTok{plot}\NormalTok{(states[sel,], }\DataTypeTok{col =} \StringTok{"blue"}\NormalTok{, }\DataTypeTok{add =} \OtherTok{TRUE}\NormalTok{)  }\CommentTok{#See Figure 2}
\end{Highlighting}
\end{Shaded}

\begin{figure}
\centering
\includegraphics{TutorialNotebook_files/figure-latex/unnamed-chunk-9-1.pdf}
\caption{Map of India, highlighting the states whose name starts with
`A'}
\end{figure}

\hypertarget{projections-setting-and-transforming-crs-in-r}{%
\subsection{Projections: setting and transforming CRS in
R}\label{projections-setting-and-transforming-crs-in-r}}

The next section requires the spatial object to have planar projections.
Thus, we first modify our spatial object to have a planar projection and
then carry our further exploration of data.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{states}\OperatorTok{@}\NormalTok{proj4string}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## CRS arguments:
##  +proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0
\end{verbatim}

The \emph{Coordinate Reference System} (CRS) of spatial objects defines
where they are placed on the Earth's surface. The above R code displays
the summary of `\texttt{proj4string}' slot of \texttt{states}. The
information that follows represents its CRS. Spatial data should always
have a CRS. If no CRS information is provided, and the correct CRS is
known, it can be set as follow:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Remove the existing CRS Information first.}
\KeywordTok{proj4string}\NormalTok{(states) <-}\StringTok{ }\OtherTok{NA_character_}
\KeywordTok{proj4string}\NormalTok{(states) <-}\StringTok{ }\KeywordTok{CRS}\NormalTok{(}\StringTok{"+init=epsg:27700"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

R issues a warning when the CRS is changed. This is so the user knows
that they are simply changing the CRS, not \emph{reprojecting} the data.
An easy way to refer to different projections is via
\href{http://www.epsg-registry.org/}{EPSG codes}.We used CRS system
\texttt{27700} representing the British National Grid. Also its worth
mentioning the commonly used CRS worldwide is `WGS84' with EPSG code
\texttt{epsg:4326}.

Now we have projected spatial object, we will now select and plot only
zones that are close to centroid of India.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(rgeos)}
\KeywordTok{plot}\NormalTok{(states, }\DataTypeTok{col =} \StringTok{"grey"}\NormalTok{)}

\CommentTok{#Find India geographic centroid}
\NormalTok{cent_del <-}\StringTok{ }\KeywordTok{gCentroid}\NormalTok{(states[states}\OperatorTok{$}\NormalTok{ST_NM }\OperatorTok{==}\StringTok{ "NCT of Delhi"}\NormalTok{,])}
\KeywordTok{points}\NormalTok{(cent_del, }\DataTypeTok{cex =} \DecValTok{3}\NormalTok{)}

\CommentTok{#Set  2° buffer}
\NormalTok{del_buffer <-}\StringTok{ }\KeywordTok{gBuffer}\NormalTok{(}\DataTypeTok{spgeom =}\NormalTok{ cent_del, }\DataTypeTok{width =} \DecValTok{2}\NormalTok{)}

\CommentTok{# We first select any intersecting zones}
\NormalTok{del_central <-}\StringTok{  }\NormalTok{states[del_buffer,]}
\CommentTok{# Now we plot our selection}
\KeywordTok{plot}\NormalTok{(del_central, }\DataTypeTok{col =} \StringTok{"lightblue"}\NormalTok{, }\DataTypeTok{add =}\NormalTok{ T)}

\CommentTok{# Next we highlight the buffer area}
\KeywordTok{plot}\NormalTok{(del_buffer, }\DataTypeTok{add =}\NormalTok{ T, }\DataTypeTok{border =} \StringTok{"red"}\NormalTok{, }\DataTypeTok{lwd =} \DecValTok{2}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{figure}
\centering
\includegraphics{TutorialNotebook_files/figure-latex/unnamed-chunk-12-1.pdf}
\caption{Plot highlighting Indian states}
\end{figure}

\hypertarget{data-preparation}{%
\section{3. Data Preparation}\label{data-preparation}}

In the following section we shall use the dataset representing road
accidents in India \href{https://data.gov.in/node/6619609}{Source -
https://data.gov.in/node/6619609}. The data provides statewise accidents
record over the year 2014 to 2017. The available data is a non-spatial
data, i.e, it doesn't contain location information of latitude and
longitude. The Spatial data we have, contains only names of state as an
attribute. It does not contain any useful information. How can we add
more infomration to our existing spatial objects? The following section
will answer this!

The non-spatial object we are going to join our \texttt{states} object
contains road accidents records for all States/UTs. The file contains
comma seperated values and can be opened using any spreadsheet program
like MS Excel.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Read csv file and Create a new data frame object accidents}
\NormalTok{accidents_raw<-}\StringTok{ }\KeywordTok{read.csv}\NormalTok{(}\StringTok{"Data/Road_Accidents_2017-Annuxure_Tables_4.csv"}\NormalTok{, }\DataTypeTok{stringsAsFactors =} \OtherTok{FALSE}\NormalTok{)}
\NormalTok{accidents <-}\StringTok{ }\NormalTok{accidents_raw }\CommentTok{#Avoid Re-Reading of CSV File}
\end{Highlighting}
\end{Shaded}

Note that accidents is a Data Frame containing 36 rows and 19 variables.
We can also infer that column \emph{States.UTs} is of type \texttt{chr},
i.e a String(Hence, no need for type coercion), and rest other columns
are \texttt{integer} and \texttt{double}. Before we join the two
datasets, we check for consistency among the joining variable. Since the
state names should ubiquitous, we check for values in
\texttt{accidents\$States.UTS} which do not occur in
\texttt{states\$ST\_NM} and vice - versa. We need to handle these
missing values accordingly.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{accidents}\OperatorTok{$}\NormalTok{States.UTs[}\OperatorTok{!}\NormalTok{accidents}\OperatorTok{$}\NormalTok{States.UTs }\OperatorTok{%in%}\StringTok{ }\NormalTok{states}\OperatorTok{$}\NormalTok{ST_NM]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "Arunachal Pradesh"         "Andaman & Nicobar Islands"
## [3] "Dadra & Nagar Haveli"      "Delhi"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{states}\OperatorTok{$}\NormalTok{ST_NM[}\OperatorTok{!}\NormalTok{states}\OperatorTok{$}\NormalTok{ST_NM }\OperatorTok{%in%}\StringTok{ }\NormalTok{accidents}\OperatorTok{$}\NormalTok{States.UTs]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "Andaman & Nicobar Island" "Arunanchal Pradesh"      
## [3] "Dadara & Nagar Havelli"   "NCT of Delhi"
\end{verbatim}

We have found the discrpenacies as a typrographical error. Therefore we
edit the states name in \texttt{states\$ST\_NM} from R's data editor.
The following line of code will open an editor, you need to correct the
errors manually. \textbf{Note} - Do not change the order of values.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{states}\OperatorTok{@}\NormalTok{data <-}\StringTok{ }\KeywordTok{edit}\NormalTok{(states}\OperatorTok{@}\NormalTok{data)}
\end{Highlighting}
\end{Shaded}

Now, we can join our data. We make use of package \textbf{dplyr} to join
two data frames. One can also use the \texttt{merge} function for the
same.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(dplyr)  }\CommentTok{#load dplyr}
\NormalTok{states}\OperatorTok{@}\NormalTok{data <-}\StringTok{ }\KeywordTok{inner_join}\NormalTok{(states}\OperatorTok{@}\NormalTok{data, accidents, }\DataTypeTok{by =} \KeywordTok{c}\NormalTok{(}\StringTok{'ST_NM'}\NormalTok{ =}\StringTok{ 'States.UTs'}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

The \texttt{*join} command assume, by default, that matching variables
have same name. Here we specify the association between two data frames,
using the `\texttt{by}' argument.

\clearpage

\hypertarget{making-maps-in-r}{%
\section{4. Making Maps in R}\label{making-maps-in-r}}

\hypertarget{ggplot2}{%
\subsection{ggplot2}\label{ggplot2}}

In this section we will look at \textbf{ggplot2} package. The package is
implementation of the Grammar of Graphics (Wilkinson 2015) - a general
scheme for data visualisation that breaks up graphs into semantic
components such as scales, layers and facets. \textbf{ggplot2} makes
plotting of complex plots easier by providing a programmatic interface
for variable specification, displaying of plots and other general visual
properties.

\textbf{ggplot2} is a
\href{http://docs.ggplot2.org/current/}{well-documented} package and
contains number of default options that match good visualisation
practices.

We start with a scatter plot for attribute data in \texttt{states}
object. As a first step, set up the data we need to plot. For this,
select the subset of data that include variables of interest. Here we
select variables specifying ``Total Number of Persons Injured'' in a
calendar year. Now our dataset represents a single variable of
information, spanned across the duration of four years. Hence, we rename
columns to represent only year number, representing number of persons
injured in each state for that year.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{#Create a temporary dataframe for analysis purpose}
\NormalTok{accidents_df <-}\StringTok{ }\NormalTok{states}\OperatorTok{@}\NormalTok{data[,}\DecValTok{1}\OperatorTok{:}\DecValTok{5}\NormalTok{]}
\CommentTok{#Rename Columns to Year only}
\KeywordTok{colnames}\NormalTok{(accidents_df) <-}\StringTok{ }\KeywordTok{gsub}\NormalTok{(}\StringTok{"}\CharTok{\textbackslash{}\textbackslash{}}\StringTok{D+}\CharTok{\textbackslash{}\textbackslash{}}\StringTok{.}\CharTok{\textbackslash{}\textbackslash{}}\StringTok{.}\CharTok{\textbackslash{}\textbackslash{}}\StringTok{."}\NormalTok{, }\StringTok{""}\NormalTok{, }\KeywordTok{colnames}\NormalTok{(accidents_df))}
\end{Highlighting}
\end{Shaded}

Before we move forward, we \texttt{tidy} the data and transform columns
into rows, using function \texttt{pivot\_longer()} from \textbf{tidyr}
package. We create a single tuple of the form \textbf{\textless ST\_NM,
Year, Person\_Injured\textgreater{}}.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(tidyr)}
\NormalTok{accidents_df.m <-}\StringTok{ }\KeywordTok{pivot_longer}\NormalTok{(accidents_df, }\KeywordTok{colnames}\NormalTok{(accidents_df)[}\DecValTok{2}\OperatorTok{:}\DecValTok{5}\NormalTok{], }\DataTypeTok{names_to =} \StringTok{"Year"}\NormalTok{, }\DataTypeTok{values_to =} \StringTok{"Persons_Injured"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

We have prepared our data for exploration. We set up a \texttt{ggplot}
object, which takes dataframe object \texttt{df.m} as input. We specify
the type of plot as scatter plot, using \texttt{geom\_point()} function.
To define the aesthetics, i.e, variables of graph, use the \texttt{aes}
function. Use \texttt{facet\_wrap()} to plot different states' scatter
plot, side by side.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(ggplot2)}
\NormalTok{p1 <-}\StringTok{ }\KeywordTok{ggplot}\NormalTok{(}\DataTypeTok{data =}\NormalTok{ accidents_df.m[}\KeywordTok{startsWith}\NormalTok{(accidents_df.m}\OperatorTok{$}\NormalTok{ST_NM, }\StringTok{"M"}\NormalTok{),], }
             \KeywordTok{aes}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ Year, }\DataTypeTok{y =}\NormalTok{ Persons_Injured)) }\OperatorTok{+}\StringTok{ }
\StringTok{  }\KeywordTok{geom_point}\NormalTok{(}\KeywordTok{aes}\NormalTok{(}\DataTypeTok{size =}\NormalTok{ Persons_Injured, }\DataTypeTok{color =}\NormalTok{ Year)) }\OperatorTok{+}
\StringTok{  }\KeywordTok{facet_wrap}\NormalTok{(}\OperatorTok{~}\NormalTok{ST_NM)}
\NormalTok{p1 }\OperatorTok{+}\StringTok{ }\KeywordTok{ggtitle}\NormalTok{(}\StringTok{"Number of Persons Injured in Road Accidents"}\NormalTok{) }\OperatorTok{+}\StringTok{  }\KeywordTok{theme}\NormalTok{(}\DataTypeTok{legend.position =} \StringTok{"bottom"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{figure}
\centering
\includegraphics{TutorialNotebook_files/figure-latex/unnamed-chunk-19-1.pdf}
\caption{A simple graphic produced with \textbf{ggplot2}}
\end{figure}

The beauty of \textbf{ggplot2} package lies in adding of layers. It
allows us to plot an spatial object \texttt{df.m}, directly, and add
layers to it.

\hypertarget{ggmap}{%
\subsection{ggmap}\label{ggmap}}

This section provides an introduction to mapping spatial data using
\textbf{ggmap} package for R, which enables the creation of maps with
\texttt{ggplot}. Based on \textbf{ggplot2}, \textbf{ggmap} package
requires data (including spatial data) to be supplied as
\texttt{data.frame}. We use \texttt{tidy()} method from package
\texttt{broom} to coerce spatial object to a data frame object, and
allow plot() functions to use \texttt{Spatial*} objects directly.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{states_df <-}\StringTok{ }\NormalTok{broom}\OperatorTok{::}\KeywordTok{tidy}\NormalTok{(states)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Regions defined for each Polygons
\end{verbatim}

\textbf{Note} : The \texttt{tidy()} method coerces the spatial data
object into a data frame. In this process of coercing, we lose the
attribute information of states object. To add it back use the
\texttt{left\_join} function from \textbf{dplyr} package.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(dplyr)}
\CommentTok{# head(states_df, n = 2) # Investigate the tide-ied data}
\NormalTok{states}\OperatorTok{$}\NormalTok{id <-}\StringTok{ }\KeywordTok{row.names}\NormalTok{(states) }\CommentTok{#Allocate an id variable to sp data}
\CommentTok{# head(states@data, n = 2) # A check before we join}
\NormalTok{states_df <-}\StringTok{ }\KeywordTok{left_join}\NormalTok{(states_df, states}\OperatorTok{@}\NormalTok{data)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Joining, by = "id"
\end{verbatim}

At this point we have a geocoded dataframe object \texttt{states\_df}
object containing location and attribute information of road accidents
in India. It is now straightforward to produce a map with
\textbf{ggplot2}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{map <-}\StringTok{ }\KeywordTok{ggplot}\NormalTok{(}\DataTypeTok{data =}\NormalTok{ states_df, }\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ long, }\DataTypeTok{y =}\NormalTok{ lat, }\DataTypeTok{group =}\NormalTok{ group, }\DataTypeTok{fill =}\NormalTok{ State.UT.wise.Total.Number.of.Persons.Injured.in.Road.Accidents.during...}\DecValTok{2015}\NormalTok{))}\OperatorTok{+}\StringTok{ }\CommentTok{# define variables}
\StringTok{  }\KeywordTok{geom_polygon}\NormalTok{() }\OperatorTok{+}\StringTok{ }\CommentTok{# Plot the states}
\StringTok{  }\KeywordTok{coord_equal}\NormalTok{() }\OperatorTok{+}\StringTok{ }\CommentTok{# fixed x & y scales}
\StringTok{  }\KeywordTok{labs}\NormalTok{(}\DataTypeTok{x =} \StringTok{"longitude"}\NormalTok{, }\DataTypeTok{y =} \StringTok{"latitude"}\NormalTok{, }\DataTypeTok{fill =} \StringTok{"Number of Persons_Injured"}\NormalTok{) }\OperatorTok{+}\StringTok{ }\CommentTok{#Labels}
\StringTok{  }\KeywordTok{ggtitle}\NormalTok{(}\StringTok{"Road Accidents in India (2015)"}\NormalTok{) }\OperatorTok{+}\StringTok{ }\CommentTok{#title}
\StringTok{  }\KeywordTok{scale_fill_gradient}\NormalTok{(}\DataTypeTok{low =} \StringTok{"white"}\NormalTok{, }\DataTypeTok{high =} \StringTok{"green"}\NormalTok{) }\CommentTok{#colours}
\NormalTok{map }\CommentTok{#Figure 4 }
\end{Highlighting}
\end{Shaded}

\begin{figure}
\centering
\includegraphics{TutorialNotebook_files/figure-latex/unnamed-chunk-22-1.pdf}
\caption{Map of Number of persons injured due to Road Accidents in
India}
\end{figure}

You can add more description from other packages as well. For example,
you can add a direction symbol using ``ggsn'' package as following

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{map }\OperatorTok{+}\StringTok{ }\NormalTok{ggsn}\OperatorTok{::}\KeywordTok{blank}\NormalTok{() }\OperatorTok{+}\StringTok{ }\NormalTok{ggsn}\OperatorTok{::}\KeywordTok{north}\NormalTok{(states_df) }\CommentTok{#Output not shown.}
\end{Highlighting}
\end{Shaded}

Next we draw comparisons of accidental injuries over the years for all
states, by faceting the plots on year basis.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Preparing the Spatial Object}
\NormalTok{states_df <-}\StringTok{ }\KeywordTok{left_join}\NormalTok{(states_df, accidents_df.m)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Joining, by = "ST_NM"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{ggplot}\NormalTok{(}\DataTypeTok{data =}\NormalTok{ states_df,}
       \KeywordTok{aes}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ long, }\DataTypeTok{y =}\NormalTok{ lat, }\DataTypeTok{fill =}\NormalTok{ Persons_Injured, }\DataTypeTok{group =}\NormalTok{ group)) }\OperatorTok{+}\StringTok{ }\CommentTok{#defining Variables}
\StringTok{  }\KeywordTok{geom_polygon}\NormalTok{() }\OperatorTok{+}\StringTok{ }\CommentTok{#plot states map}
\StringTok{  }\KeywordTok{geom_path}\NormalTok{(}\DataTypeTok{colour =} \StringTok{"black"}\NormalTok{, }\DataTypeTok{lwd =} \FloatTok{0.05}\NormalTok{) }\OperatorTok{+}\StringTok{ }\CommentTok{# states borders}
\StringTok{  }\KeywordTok{coord_equal}\NormalTok{() }\OperatorTok{+}\StringTok{ }\CommentTok{#fixed x and y scales}
\StringTok{  }\KeywordTok{facet_wrap}\NormalTok{(}\OperatorTok{~}\StringTok{ }\NormalTok{Year) }\OperatorTok{+}\StringTok{ }\CommentTok{# one plot per year}
\StringTok{  }\KeywordTok{scale_fill_gradient}\NormalTok{(}\DataTypeTok{low =} \StringTok{"white"}\NormalTok{, }\DataTypeTok{high =} \StringTok{"green"}\NormalTok{,}
                      \DataTypeTok{name =} \StringTok{"No. of Persons Injured"}\NormalTok{) }\OperatorTok{+}\StringTok{ }\CommentTok{# legend options}
\StringTok{  }\KeywordTok{theme}\NormalTok{(}\DataTypeTok{axis.text =} \KeywordTok{element_blank}\NormalTok{(), }\CommentTok{# remove axis lables}
        \DataTypeTok{axis.title =} \KeywordTok{element_blank}\NormalTok{(), }\CommentTok{# remove axis titles}
        \DataTypeTok{axis.ticks =} \KeywordTok{element_blank}\NormalTok{()) }\CommentTok{# remove axis ticks}
\end{Highlighting}
\end{Shaded}

\begin{figure}
\centering
\includegraphics{TutorialNotebook_files/figure-latex/unnamed-chunk-24-1.pdf}
\caption{Figure depicting the number of persons injured in India due to
road accidents over the years}
\end{figure}

\hypertarget{tmap}{%
\subsection{tmap}\label{tmap}}

In this section, we will look at another map making tool in R, called
\textbf{tmap}. \textbf{tmap} was created to overcome some of the
limitations of base graphics and \textbf{ggmap}. A concise introduction
to tmap can be accessed (after the package is installed) by using
\texttt{vignette\ ("tmap-getstarted")} function.

The following section and upcoming sections are inspired, and reproduced
from
\href{http://www.spatialanalysisonline.com/An\%20Introduction\%20to\%20Spatial\%20Data\%20Analysis\%20in\%20R.pdf}{An
Introduction to Spatial Data Analysis in R}. From here onwards, we use
\emph{Camden's Output Area, Census Estimates} dataset, provided at
\href{https://data.cdrc.ac.uk/tutorial/an-introduction-to-spatial-data-analysis-and-visualisation-in-r}{CDRC
website}.

I. Load the Shapefiles We begin with importing the camden open area
shapefile.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{Output.Areas <-}\StringTok{ }\KeywordTok{readOGR}\NormalTok{(}\DataTypeTok{dsn =} \StringTok{"Data/Camden_oa11/Camden_oa11.shp"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## OGR data source with driver: ESRI Shapefile 
## Source: "G:\Mayur\IIIT Bangalore\Docs\Reading Elective-GIS\GISTutorial\Data\Camden_oa11\Camden_oa11.shp", layer: "Camden_oa11"
## with 749 features
## It has 1 fields
\end{verbatim}

\begin{enumerate}
\def\labelenumi{\Roman{enumi}.}
\setcounter{enumi}{1}
\tightlist
\item
  Join with Census Data Load the census data from
  \texttt{camden\_census\_data.csv} and join with camden open areas
  shapefile.
\end{enumerate}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{Census.Data <-}\StringTok{ }\KeywordTok{read.csv}\NormalTok{(}\StringTok{"Data/camden_census_data.csv"}\NormalTok{)}
\NormalTok{OA.census <-}\StringTok{ }\KeywordTok{merge}\NormalTok{(Output.Areas, Census.Data, }\DataTypeTok{by.x =} \StringTok{"OA11CD"}\NormalTok{, }\DataTypeTok{by.y =} \StringTok{"OA"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Next we need to have correct CRS arguments for projections. Most data
from the UK is projected using the British National Grid codes,
(EPSG:27700/OSGB36/WGS84). However, in this case - the shapefile has
correct CRS arguments for Projections, and doesn't need to be specified
explicitly.

\begin{enumerate}
\def\labelenumi{\Roman{enumi}.}
\setcounter{enumi}{2}
\tightlist
\item
  Create the Map Now we are in position to plot the basic maps using
  \textbf{tmap}.
\end{enumerate}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# load the pacakges}
\KeywordTok{library}\NormalTok{(tmap)}
\KeywordTok{qtm}\NormalTok{(OA.census, }\DataTypeTok{fill =} \StringTok{"Qualification"}\NormalTok{) }\CommentTok{#Output not shown}
\end{Highlighting}
\end{Shaded}

\includegraphics{TutorialNotebook_files/figure-latex/unnamed-chunk-27-1.pdf}

The \texttt{qtm()} from \textbf{tmap} draws a quick plot, with legend.
The drawn map, gives us an insight to \emph{qualified} youth percentage
in Camden. \textbf{tmap} package provides many more functionalities for
plotting, which are relatively simple to use when compared with other
packages like \textbf{ggmap}.

We explore the \textbf{tmap} package a little more in details and
demonstrate its map drawing capabilities with more statistical
infomation.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# library(RColorBrewer) # To explore predefined colour ramps using display.brewer.all()}
\CommentTok{# display.brewer.all()  # To view all color pallets available}
\KeywordTok{tm_shape}\NormalTok{(OA.census) }\OperatorTok{+}\StringTok{ }\KeywordTok{tm_fill}\NormalTok{(}\StringTok{"Qualification"}\NormalTok{, }\DataTypeTok{palette =} \StringTok{"-YlOrRd"}\NormalTok{,}
                              \DataTypeTok{style =} \StringTok{"pretty"}\NormalTok{, }\CommentTok{#specify color intervals}
                              \DataTypeTok{legend.hist =} \OtherTok{TRUE}\NormalTok{) }\OperatorTok{+}\StringTok{ }\CommentTok{#add histogram legend}
\StringTok{  }\KeywordTok{tm_compass}\NormalTok{()  }\CommentTok{#Add north arrow}
\end{Highlighting}
\end{Shaded}

\includegraphics{TutorialNotebook_files/figure-latex/unnamed-chunk-28-1.pdf}

The map drawn above, is similar to one drawn using \texttt{qtm()}. But,
it is more detailed and descriptive about the \emph{qualified} youth in
camden. While plotting with \textbf{tmap}, we specify color intervals
using \texttt{style} parameter. Each \texttt{style} parameter has an
impact on how data is visualised. You can specify following color
intervals - - \texttt{equal} - divides the range of the variable into n
parts. - \texttt{pretty} - chooses a number of breaks to fit a sequence
of equally spaced `round' values. So the keys for these intervals are
always tidy and memorable. - \texttt{quantile} - equal number of cases
in each group - \texttt{jenks} - looks for natural breaks in the data -
\texttt{Cat} - if the variable is categorical (i.e.~not continuous data)

\clearpage

\clearpage

\hypertarget{spatial-analysis-in-r---a-deeper-look}{%
\section{5. Spatial Analysis in R - A Deeper
Look}\label{spatial-analysis-in-r---a-deeper-look}}

In this section, we will run a kernel density estimation(KDE) in R. KDE
is a commonly used means of representing densities of spatial data
points. The technique produces a smooth and continuous surface where
each pixel represents a density value bases on the number of points
within a given distance badnwidth. We will also look at creating and
mapping of raster shapefiles.

I. Data Preparation. Download the House Sales Shapefile, from
\href{https://data.cdrc.ac.uk/tutorial/an-introduction-to-spatial-data-analysis-and-visualisation-in-r}{CDRC
website}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# load house point files}
\NormalTok{House.Points <-}\StringTok{ }\KeywordTok{readOGR}\NormalTok{(}\DataTypeTok{dsn =} \StringTok{"Data/Camden_house_sales/Camden_house_sales.shp"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## OGR data source with driver: ESRI Shapefile 
## Source: "G:\Mayur\IIIT Bangalore\Docs\Reading Elective-GIS\GISTutorial\Data\Camden_house_sales\Camden_house_sales.shp", layer: "Camden_house_sales"
## with 2547 features
## It has 4 fields
\end{verbatim}

\begin{enumerate}
\def\labelenumi{\Roman{enumi}.}
\setcounter{enumi}{1}
\tightlist
\item
  Data Exploration The following code run a kernel density estimation
  for Land Registry house price data. There are several different ways
  to run this through R, we will use the functions available from the
  \texttt{adehabitatHR} package.
\end{enumerate}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# load the libraries}
\KeywordTok{library}\NormalTok{(raster)}
\KeywordTok{library}\NormalTok{(adehabitatHR)}

\CommentTok{# runs the kernel density estimation, look up the function parameters for more options}
\NormalTok{kde.output <-}\StringTok{ }\KeywordTok{kernelUD}\NormalTok{(House.Points, }\DataTypeTok{h=}\StringTok{"href"}\NormalTok{, }\DataTypeTok{grid =} \DecValTok{1000}\NormalTok{)}

\KeywordTok{plot}\NormalTok{(kde.output)}
\end{Highlighting}
\end{Shaded}

\includegraphics{TutorialNotebook_files/figure-latex/unnamed-chunk-30-1.pdf}

\begin{enumerate}
\def\labelenumi{\Roman{enumi}.}
\setcounter{enumi}{2}
\tightlist
\item
  Analyse the Data To map the raster in tmap, we first need to ensure it
  has been projected correctly.
\end{enumerate}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# converts to raster}
\NormalTok{kde <-}\StringTok{ }\KeywordTok{raster}\NormalTok{(kde.output)}
\CommentTok{# set the projection to British National Grid, EPSG:27700}
\KeywordTok{projection}\NormalTok{(kde) <-}\StringTok{ }\KeywordTok{CRS}\NormalTok{(}\StringTok{"+init=EPSG:27700"}\NormalTok{)}

\CommentTok{# maps the raster in tmap, "ud" is the density variable}
\KeywordTok{tm_shape}\NormalTok{(kde) }\OperatorTok{+}\StringTok{ }\KeywordTok{tm_raster}\NormalTok{(}\StringTok{"ud"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{TutorialNotebook_files/figure-latex/unnamed-chunk-31-1.pdf}

As evident, the raster includes a lot of empty space, we next zoom in on
Camden by setting the map to the extents of a bounding box.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# creates a bounding box based on the extents of the Output.Areas polygon}
\NormalTok{bounding_box <-}\StringTok{ }\KeywordTok{bbox}\NormalTok{(Output.Areas)}

\CommentTok{#maps the raster within the bounding box}
\KeywordTok{tm_shape}\NormalTok{(kde, }\DataTypeTok{bbox =}\NormalTok{ bounding_box) }\OperatorTok{+}\StringTok{ }\KeywordTok{tm_raster}\NormalTok{(}\StringTok{"ud"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{TutorialNotebook_files/figure-latex/unnamed-chunk-32-1.pdf}

Next we mask(or clip) the raster by the output areas polygon and tidy up
the graphic. This operation only preserves the parts of the raster which
are within the spatial extent of the masking polygon.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# mask the raster by the output area polygon}
\NormalTok{masked_kde <-}\StringTok{ }\KeywordTok{mask}\NormalTok{(kde, Output.Areas)}

\CommentTok{# maps the masked raster, also maps white output area boundaries}
\KeywordTok{tm_shape}\NormalTok{(masked_kde, }\DataTypeTok{bbox =}\NormalTok{ bounding_box) }\OperatorTok{+}\StringTok{ }\KeywordTok{tm_raster}\NormalTok{(}\StringTok{"ud"}\NormalTok{, }\DataTypeTok{style =} \StringTok{"quantile"}\NormalTok{,}
                                                      \DataTypeTok{n =} \DecValTok{100}\NormalTok{,}
                                                      \DataTypeTok{legend.show =} \OtherTok{FALSE}\NormalTok{,}
                                                      \DataTypeTok{palette =} \StringTok{"Blues"}\NormalTok{) }\OperatorTok{+}\StringTok{ }
\StringTok{  }\KeywordTok{tm_shape}\NormalTok{(Output.Areas) }\OperatorTok{+}\StringTok{ }\KeywordTok{tm_borders}\NormalTok{(}\DataTypeTok{alpha =} \FloatTok{0.3}\NormalTok{, }\DataTypeTok{col =} \StringTok{"white"}\NormalTok{) }\OperatorTok{+}\StringTok{ }
\StringTok{  }\KeywordTok{tm_layout}\NormalTok{(}\DataTypeTok{frame =} \OtherTok{FALSE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{TutorialNotebook_files/figure-latex/unnamed-chunk-33-1.pdf}

From kernel density estimates, we can also create catchment boundaries
to identify homeranges.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# compute homeranges for 75%, 50%, 25% and 10% of points,}
\CommentTok{# note : objects are returned as spatial polygons data frames}
\NormalTok{range75 <-}\StringTok{ }\KeywordTok{getverticeshr}\NormalTok{(kde.output, }\DataTypeTok{percent =} \DecValTok{75}\NormalTok{)}
\NormalTok{range50 <-}\StringTok{ }\KeywordTok{getverticeshr}\NormalTok{(kde.output, }\DataTypeTok{percent =} \DecValTok{50}\NormalTok{)}
\NormalTok{range25 <-}\StringTok{ }\KeywordTok{getverticeshr}\NormalTok{(kde.output, }\DataTypeTok{percent =} \DecValTok{25}\NormalTok{)}
\NormalTok{range10 <-}\StringTok{ }\KeywordTok{getverticeshr}\NormalTok{(kde.output, }\DataTypeTok{percent =} \DecValTok{10}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

After we have calculated homeranges, we can plot them together in tmap,
Remember, tmap (like ggmap) combines multiple layers, and layer at the
bottom of the list is the last one to be printed. Thus last layer
printed, appears at the front of the graphic.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# the code below creates a map of several layers using tmap}
\KeywordTok{tm_shape}\NormalTok{(Output.Areas) }\OperatorTok{+}\StringTok{ }\KeywordTok{tm_borders}\NormalTok{(}\DataTypeTok{alpha=}\NormalTok{.}\DecValTok{8}\NormalTok{, }\DataTypeTok{col =} \StringTok{"white"}\NormalTok{) }\OperatorTok{+}
\StringTok{    }\KeywordTok{tm_fill}\NormalTok{(}\DataTypeTok{col =} \StringTok{"#f0f0f0"}\NormalTok{) }\OperatorTok{+}\StringTok{ }
\StringTok{  }\KeywordTok{tm_shape}\NormalTok{(House.Points) }\OperatorTok{+}\StringTok{ }\KeywordTok{tm_dots}\NormalTok{(}\DataTypeTok{col =} \StringTok{"blue"}\NormalTok{) }\OperatorTok{+}\StringTok{ }
\StringTok{  }\KeywordTok{tm_shape}\NormalTok{(range75) }\OperatorTok{+}\StringTok{ }\KeywordTok{tm_borders}\NormalTok{(}\DataTypeTok{alpha =} \FloatTok{.7}\NormalTok{, }\DataTypeTok{col =} \StringTok{"#e57373"}\NormalTok{, }\DataTypeTok{lwd =} \DecValTok{2}\NormalTok{) }\OperatorTok{+}
\StringTok{    }\KeywordTok{tm_fill}\NormalTok{(}\DataTypeTok{alpha =}\NormalTok{.}\DecValTok{2}\NormalTok{, }\DataTypeTok{col =} \StringTok{"#e57373"}\NormalTok{) }\OperatorTok{+}
\StringTok{  }\KeywordTok{tm_shape}\NormalTok{(range50) }\OperatorTok{+}\StringTok{ }\KeywordTok{tm_borders}\NormalTok{(}\DataTypeTok{alpha =} \FloatTok{.7}\NormalTok{, }\DataTypeTok{col =} \StringTok{"#f44336"}\NormalTok{, }\DataTypeTok{lwd =} \DecValTok{2}\NormalTok{) }\OperatorTok{+}
\StringTok{    }\KeywordTok{tm_fill}\NormalTok{(}\DataTypeTok{alpha =}\NormalTok{.}\DecValTok{2}\NormalTok{, }\DataTypeTok{col =} \StringTok{"#f44336"}\NormalTok{) }\OperatorTok{+}
\StringTok{  }\KeywordTok{tm_shape}\NormalTok{(range25) }\OperatorTok{+}\StringTok{ }\KeywordTok{tm_borders}\NormalTok{(}\DataTypeTok{alpha =} \FloatTok{.7}\NormalTok{, }\DataTypeTok{col =} \StringTok{"#b71c1c"}\NormalTok{, }\DataTypeTok{lwd =} \DecValTok{2}\NormalTok{) }\OperatorTok{+}
\StringTok{    }\KeywordTok{tm_fill}\NormalTok{(}\DataTypeTok{alpha =}\NormalTok{.}\DecValTok{1}\NormalTok{, }\DataTypeTok{col =} \StringTok{"#b71c1c"}\NormalTok{) }\OperatorTok{+}
\StringTok{  }\KeywordTok{tm_shape}\NormalTok{(range10) }\OperatorTok{+}\StringTok{ }\KeywordTok{tm_borders}\NormalTok{(}\DataTypeTok{alpha =} \FloatTok{.7}\NormalTok{, }\DataTypeTok{col =} \StringTok{"#d50000"}\NormalTok{, }\DataTypeTok{lwd =} \DecValTok{2}\NormalTok{) }\OperatorTok{+}
\StringTok{    }\KeywordTok{tm_fill}\NormalTok{(}\DataTypeTok{alpha =}\NormalTok{.}\DecValTok{1}\NormalTok{, }\DataTypeTok{col =} \StringTok{"#d50000"}\NormalTok{) }\OperatorTok{+}
\StringTok{  }\KeywordTok{tm_layout}\NormalTok{(}\DataTypeTok{frame =} \OtherTok{FALSE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{TutorialNotebook_files/figure-latex/unnamed-chunk-35-1.pdf}

Whilst mapping the densities of house sales is reasonably interesting,
this technique can be applied to all sorts of point data. You could, for
example, get two sets of data and create two seperate ranges to compare
their distributions - i.e.~two species of animals. You can also infer
areas of high risk locations, in a situation of public disorder in a
city.

\hypertarget{references}{%
\section{References}\label{references}}

Lovelace, R., Cheshire, J. and Oldroyd, R. (2017). Introduction to
visualising spatial data in R.
\href{https://github.com/Robinlovelace/Creating-maps-in-R}{ebook}{[}Accessed
18 May 2017{]}.

Sadler, J. (2019). Introduction to GIS with R. {[}online{]} Jesse
Sadler. Available at:
\url{https://www.jessesadler.com/post/gis-with-r-intro/} {[}Accessed 25
Dec.~2019{]}.

Brunsdon, C. and Comber, L. (2015). An Introduction to R for Spatial
Analysis and Mapping. 1st ed.

Lansley, G. and Cheshire, J. (2016). An Introduction to Spatial Data
Analysis andVisualisation in R.
\href{http://www.spatialanalysisonline.com/An\%20Introduction\%20to\%20Spatial\%20Data\%20Analysis\%20in\%20R.pdf}{ebook}
{[}Accessed 28 Dec.~2019{]}.

\begin{verbatim}
## [1] 1
\end{verbatim}


\end{document}
